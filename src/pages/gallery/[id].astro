---
import Layout from '../../layouts/Layout.astro';
import { supabase } from '../../lib/supabase';
import SectionTitle from '../../components/SectionTitle.astro';

export async function getStaticPaths() {
    // If output is 'server', this is not strictly needed but good for reference.
    // However, since we are in SSR mode, we rely on dynamic routing at runtime.
    return [];
}

const { id } = Astro.params;

// Fetch tattoo details
const { data: tattoo, error } = await supabase
  .from('tattoos')
  .select('*')
  .eq('id', id)
  .single();

if (error || !tattoo) {
  return new Response(null, {
    status: 404,
    statusText: 'Not found'
  });
}

const { title, image_url, tags, published_date, description } = tattoo;
---

<Layout title={`${tattoo.title} | L'Art Mûrit`}>
    <section class="min-h-screen relative bg-black pt-32 pb-20 px-4 overflow-hidden">
        
        <!-- Background Blur Effect -->
        <div class="absolute inset-0 z-0">
             <div class="absolute inset-0 bg-black/60 z-10"></div>
             <img src={image_url} alt="Blur Background" class="w-full h-full object-cover blur-[100px] opacity-30 scale-110" />
        </div>

        <div class="max-w-7xl mx-auto relative z-10 grid lg:grid-cols-2 gap-12 items-center">
            
            <!-- Image Section -->
            <div class="order-2 lg:order-1 flex justify-center items-start">
                <div class="relative group inline-block bg-black/50 border border-white/10 rounded-sm overflow-hidden animate-[fadeIn_0.5s_ease-out]">
                     <img 
                        src={image_url} 
                        alt={title} 
                        class="block max-w-full max-h-[85vh] w-auto h-auto object-contain p-1 hover:scale-[1.01] transition-transform duration-700 ease-in-out" 
                     />
                </div>
            </div>

            <!-- Details Section -->
            <div class="order-1 lg:order-2 flex flex-col items-start space-y-8 animate-[slideInRight_0.5s_ease-out]">
                <a href="/gallery" class="text-gray-400 hover:text-white uppercase tracking-widest text-sm flex items-center gap-2 group transition-colors">
                    <span class="transform group-hover:-translate-x-1 transition-transform">←</span> Retour à la galerie
                </a>

                <div>
                    <span class="text-[var(--color-primary)] font-heading font-bold tracking-widest uppercase text-sm mb-2 block">
                        {new Date(published_date).toLocaleDateString()}
                    </span>
                    <h1 class="text-5xl md:text-7xl font-heading font-bold uppercase text-white leading-none">
                        {title}
                    </h1>
                </div>

                <div class="flex flex-wrap gap-2">
                    {tags?.map(tag => (
                        <span class="px-3 py-1 border border-white/20 rounded-full text-xs uppercase tracking-wider text-gray-300">
                            #{tag}
                        </span>
                    ))}
                </div>

                <div class="prose prose-invert max-w-none text-gray-400 font-light text-lg">
                    <p>
                        {description || "Une pièce unique réalisée avec passion et précision. Chaque tatouage est une collaboration entre l'artiste et le client pour créer quelque chose d'intemporel."}
                    </p>
                </div>

                <div class="pt-8 border-t border-white/10 w-full">
                    <p class="text-white font-heading font-bold uppercase tracking-widest mb-6">Intéressé par ce style ?</p>
                    <a href="/booking" class="inline-block px-10 py-4 bg-[var(--color-primary)] text-white font-heading font-bold uppercase tracking-widest hover:bg-white hover:text-black transition-all duration-300">
                        Réserver un projet similaire
                    </a>
                </div>
            </div>
        </div>
    </section>
</Layout>
