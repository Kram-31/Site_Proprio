---
import Layout from '../../layouts/Layout.astro';
import { supabase } from '../../lib/supabase';

const { slug } = Astro.params;

// Fetch tattoo from Supabase
const { data: tattoo, error } = await supabase
  .from('tattoos')
  .select('*')
  .eq('id', slug)
  .single();

if (error || !tattoo) {
  return Astro.redirect('/404');
}
---

<Layout title={`${tattoo.title} | L'Art Mûri`}>
  <section class="pt-32 pb-20 px-4 min-h-screen flex flex-col items-center bg-[#050505]">
    <div class="max-w-6xl w-full">
      <a href="/gallery" class="inline-flex items-center text-sm font-heading font-bold uppercase tracking-widest text-gray-400 hover:text-[var(--color-primary)] transition-colors mb-8">
        ← Retour à la galerie
      </a>

      <div class="grid md:grid-cols-2 gap-12 lg:gap-20 bg-gray-900/30 p-8 border border-white/10 backdrop-blur-sm rounded-lg">
        <!-- Image Section -->
        <div class="relative aspect-[3/4] w-full overflow-hidden rounded-sm group">
            <img 
                src={tattoo.image_url} 
                alt={tattoo.title} 
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" 
            />
        </div>

        <!-- Info Section -->
        <div class="flex flex-col justify-center">
            <span class="text-[var(--color-primary)] font-heading font-bold uppercase tracking-widest text-sm mb-2">
                {new Date(tattoo.published_date).toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' })}
            </span>
            <h1 class="text-4xl md:text-6xl font-heading font-bold uppercase mb-8 leading-none text-white">
                {tattoo.title}
            </h1>

            <div class="flex flex-wrap gap-2 mb-8">
                {tattoo.tags?.map((tag: string) => (
                    <span class="px-3 py-1 border border-white/20 text-xs font-heading font-bold uppercase tracking-wider text-gray-300">
                        {tag}
                    </span>
                ))}
            </div>

            <div class="prose prose-lg prose-invert prose-p:text-gray-400 prose-p:font-light prose-headings:font-heading prose-headings:uppercase prose-strong:text-white">
                <p>{tattoo.description}</p>
            </div>
            
            <div class="mt-8 pt-8 border-t border-white/10">
                 <a href="/booking" class="bg-white text-black font-heading font-bold uppercase px-8 py-3 hover:bg-[var(--color-primary)] hover:text-white transition-colors">
                    Réserver ce style
                 </a>
            </div>
        </div>
      </div>
    </div>
  </section>
</Layout>
